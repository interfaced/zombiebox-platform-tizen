var msf=function(t){function e(i){if(n[i])return n[i].exports;var s=n[i]={exports:{},id:i,loaded:!1};return t[i].call(s.exports,s,s.exports,e),s.loaded=!0,s.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){var i,s=n(1);s.version="{{version}}",i=function(){return s}.call(e,n,e,t),!(void 0!==i&&(t.exports=i)),t.exports=s},function(t,e,n){"use strict";var i=n(2),s=(n(9),n(10)),o=n(15),r=null;t.exports.logger=i.logger,t.exports.search=function(t){return r||(r=new o),t&&(r.once("found",function(e){t(null,e)}),setTimeout(function(){r.start()},0)),r},t.exports.local=function(t){s.getLocal(t)},t.exports.remote=function(t,e){s.getByURI(t,e)}},function(t,e,n){t.exports={logger:n(3),url:n(4),inherits:n(6),props:n(7),types:n(8),queryString:n(5)}},function(t,e){"use strict";function n(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t),s.log.apply(s,e)}}for(var i=["error","warn","info","verbose","debug","silly"],s={level:"disabled",log:function(t){if("disabled"!==s.level&&i.indexOf(t)<=i.indexOf(s.level)){var e=Array.prototype.slice.call(arguments,1);e.unshift("[MSF:"+t.toUpperCase()+"]"),console[t]?console[t].apply(console,e):console.log.apply(console,e)}}},o=0;o<i.length;o++){var r=i[o];s[r]=n(r)}t.exports=s},function(t,e,n){"use strict";var i=n(5),s={isValid:function(t){var e=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/;return!!t.match(e)},parse:function(t){var e={},n=document.createElement("a");return n.href=t,e.href=n.href,e.protocol=n.protocol,e.hostname=n.hostname,e.port=n.port,e.pathname=n.pathname,e.search=n.search,e.hash=n.hash,e.host=n.host,e.queryString=i.parse(n.search),e}};t.exports=s},function(t,e){"use strict";/*!
	 query-string
	 Parse and stringify URL query strings
	 https://github.com/sindresorhus/query-string
	 by Sindre Sorhus
	 MIT License
	 */
var n={};n.parse=function(t){return"string"!=typeof t?{}:(t=t.trim().replace(/^(\?|#)/,""),t?t.trim().split("&").reduce(function(t,e){var n=e.replace(/\+/g," ").split("="),i=n[0],s=n[1];return i=decodeURIComponent(i),s=void 0===s?null:decodeURIComponent(s),t.hasOwnProperty(i)?Array.isArray(t[i])?t[i].push(s):t[i]=[t[i],s]:t[i]=s,t},{}):{})},n.stringify=function(t){return t?Object.keys(t).map(function(e){var n=t[e];return Array.isArray(n)?n.map(function(t){return encodeURIComponent(e)+"="+encodeURIComponent(t)}).join("&"):encodeURIComponent(e)+"="+encodeURIComponent(n)}).join("&"):""},t.exports=n},function(t,e){"use strict";"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},function(t,e){"use strict";function n(t,e,n,i){return{enumerable:t,configurable:e,writable:n,value:i}}t.exports={readOnly:function(t,e){Array.isArray(e)?e.forEach(function(e){Object.defineProperty(t,e,n(!0,!0,!1,t[e]))}):Object.defineProperty(t,e,n(!0,!0,!1,t[e]))},private:function(t,e){Array.isArray(e)?e.forEach(function(e){Object.defineProperty(t,e,n(!1,!0,!0,t[e]))}):Object.defineProperty(t,e,n(!1,!0,!0,t[e]))}}},function(t,e){"use strict";t.exports={isString:function(t){return"string"==typeof t},isNull:function(t){return null===t},isBoolean:function(t){return"boolean"==typeof t},isNumber:function(t){return"number"==typeof t},isObject:function(t){return t===Object(t)},isArray:function(t){return t.constructor===Array},isFunction:function(t){return"function"==typeof t},isUndefined:function(t){return"undefined"==typeof t}}},function(t,e){"use strict";function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(t){return"function"==typeof t}function s(t){return"number"==typeof t}function o(t){return"object"==typeof t&&null!==t}function r(t){return void 0===t}t.exports=n,n.EventEmitter=n,n.prototype._disabledEvents={},n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(t){if(!s(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},n.prototype.emit=function(t){var e,n,s,c,a,l;if(this._events||(this._events={}),this._disabledEvents[t])return!1;if("error"===t&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if(e=arguments[1],e instanceof Error)throw e;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[t],r(n))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(s=arguments.length,c=new Array(s-1),a=1;a<s;a++)c[a-1]=arguments[a];n.apply(this,c)}else if(o(n)){for(s=arguments.length,c=new Array(s-1),a=1;a<s;a++)c[a-1]=arguments[a];for(l=n.slice(),s=l.length,a=0;a<s;a++){var h=l[a].apply(this,c);if("stopEvent"===h)break}}return!0},n.prototype.addListener=function(t,e){var s;if(!i(e))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,i(e.listener)?e.listener:e),this._events[t]?o(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,o(this._events[t])&&!this._events[t].warned){var s;s=r(this._maxListeners)?n.defaultMaxListeners:this._maxListeners,s&&s>0&&this._events[t].length>s&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace())}return this},n.prototype.on=function(t,e){n.prototype.addListener.apply(this,arguments)},n.prototype.once=function(t,e){function n(){this.removeListener(t,n),s||(s=!0,e.apply(this,arguments))}if(!i(e))throw TypeError("listener must be a function");var s=!1;return n.listener=e,this.on(t,n),this},n.prototype.removeListener=function(t,e){var n,s,r,c;if(!i(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(n=this._events[t],r=n.length,s=-1,n===e||i(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(o(n)){for(c=r;c-- >0;)if(n[c]===e||n[c].listener&&n[c].listener===e){s=c;break}if(s<0)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(s,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},n.prototype.off=function(t,e){n.prototype.removeListener.apply(this,arguments)},n.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[t],i(n))this.removeListener(t,n);else for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},n.prototype.listeners=function(t){var e;return e=this._events&&this._events[t]?i(this._events[t])?[this._events[t]]:this._events[t].slice():[]},n.prototype.disableEvent=function(t){t&&"string"==typeof t&&(this._disabledEvents[t]=!0)},n.prototype.enableEvent=function(t){t&&"string"==typeof t&&delete this._disabledEvents[t]},n.listenerCount=function(t,e){var n;return n=t._events&&t._events[e]?i(t._events[e])?1:t._events[e].length:0}},function(t,e,n){"use strict";function i(t){this.id=t.id,this.name=t.name,this.version=t.version,this.type=t.type,this.uri=t.uri,this.device=t.device,o.readOnly(this,["id","name","version","type","uri","device"])}var s=n(2),o=s.props,r=n(11),c=n(12);i.prototype.application=function(t,e){return new r(this,t,e)},i.prototype.channel=function(t){return new c(this,t)},i.getLocal=function(t){i.getByURI("http://127.0.0.1:8001/api/v2/",t)},i.getByURI=function(t,e){var n=new XMLHttpRequest;n.timeout=5e3,n.ontimeout=function(){e()},n.onload=function(){if(200===this.status)try{var t=JSON.parse(this.responseText);e(null,new i(t))}catch(t){e(t)}else e()},n.open("get",t,!0),n.send()},t.exports=i},function(t,e,n){"use strict";function i(t,e,n){if(!r.isObject(t))throw new TypeError("service must be of type Service");if(!r.isString(e))throw new TypeError("id must be a valid string");if(!r.isString(n))throw new TypeError("channelId must be a valid string");this.type=e.match(/(file:\/\/|http(s)?:\/\/)/gim)?h:l,i.super_.call(this,t,n),this.id=e,this.service=t,this.on("clientDisconnect",function(t){t.isHost&&this.disconnect()}.bind(this)),this.disableEvent("connect"),c.readOnly(this,"id"),c.private(this,"type","service")}var s=n(2),o=s.logger,r=s.types,c=s.props,a=n(12),l="applications",h="webapplication";s.inherits(i,a),i.prototype.connect=function(t,e){if(!r.isObject(t))throw new TypeError("attributes must be a valid object");if(!r.isFunction(e))throw new TypeError("callback must be a valid function");a.prototype.connect.call(this,t,function(t,n){if(t)return e(t);this.connected=!1;var i=function(){this.connected=!0,e&&(o.debug("application.connect->callback",null,n),e(null,n)),o.debug('application.emit("connect")',n),this.enableEvent("connect"),this.emit("connect",n),this.disableEvent("connect")}.bind(this);this.once("ready",i)}.bind(this))},i.prototype.disconnect=function(t,e){if(r.isFunction(t)&&(e=t,t=!0),r.isUndefined(t)&&(t=!0),t&&this.clients.length<=2){var n=function(t){a.prototype.disconnect.call(this,e)}.bind(this);"webapplication"===this.type?this.invoke("ms.webapplication.stop",{url:this.id},n):this.invoke("ms.application.stop",{id:this.id},n)}else a.prototype.disconnect.call(this,e)},i.prototype.install=function(t){if(this.type===h)return t(new Error("web application cannot be installed"));var e,n=new XMLHttpRequest;n.timeout=1e4,n.ontimeout=function(){e=new Error("Request Timeout"),e.code=408,t(e)},n.onload=function(){200===this.status?t(null,!0):(e=new Error(this.statusText),e.code=this.status,t(e))},n.open("put",this.service.uri+"applications/"+this.id,!0),n.send()},i.prototype.start=function(t){var e,n=new XMLHttpRequest;n.timeout=1e4,n.ontimeout=function(){e=new Error("Request Timeout"),e.code=408,t(e)},n.onload=function(){200===this.status?t(null,!0):(e=new Error(this.statusText),e.code=this.status,t(e))},this.type===h?(n.open("post",this.service.uri+"webapplication/",!0),n.setRequestHeader("Content-Type","application/json;charset=UTF-8"),n.send(JSON.stringify({url:this.id}))):(n.open("post",this.service.uri+"applications/"+this.id,!0),n.setRequestHeader("Content-Type","application/json;charset=UTF-8"),n.send(JSON.stringify({})))},t.exports=i},function(t,e,n){"use strict";function i(t,e){if(o.debug("new Channel",arguments),!r.isObject(t))throw new TypeError("service must be of type Service");if(!r.isString(e))throw new TypeError("uri must be a valid string");i.super_.call(this);var n=this,a=s.url.parse(t.uri);this.connected=!1,this.clientId=null,this.connection=null,this.securityMode=!1,this.resultHandlers={},this.connectionUrl="ws://"+a.host+a.pathname+"channels/"+e,this.pingTimeout=null,this.pingInterval=null,this.clients=new h(this),Object.defineProperty(this,"isConnected",{get:function(){return n.connected}}),Object.defineProperty(this,"connectionTimeout",{set:function(t){o.debug("updating connection timeout ",t),n.pingTimeout=t>0?t:0,this.isConnected&&n.startHealthCheck()},get:function(){return n.pingTimeout}}),this.on("connect",this.startHealthCheck),this.on("disconnect",this.stopHealthCheck),c.readOnly(this,["clients"]),c.private(this,["connected","clientId","connection","resultHandlers","connectionUrl","connectCallback","pingInterval","pingTimeout","lastPingReceived","securityMode"])}var s=n(2),o=s.logger,r=s.types,c=s.props,a=n(9),l=n(13),h=n(14),u="__ping";s.inherits(i,a),i.prototype.connect=function(t,e){if(o.debug("channel.connect",arguments),this.isConnected)return console.warn("Channel is already connected.");if(r.isFunction(t)&&!e?(e=t,t={}):t=t||{},!r.isObject(t))throw new TypeError("attributes must be a valid object");if(e&&!r.isFunction(e))throw new TypeError("callback must be a valid function");this.connectCallback=e;var n=" ";n=this.securityMode?this.connectionUrl.replace("ws","wss").replace("8001","8002"):this.connectionUrl,n=n+"?"+s.queryString.stringify(t),this.connection&&(this.connection.onopen=null,this.connection.onerror=null,this.connection.onclose=null,this.connection.onmessage=null),this.connection=new WebSocket(n),this.connection.binaryType="arraybuffer",this.connection.onopen=this._onSocketOpen.bind(this),this.connection.onerror=this._onSocketError.bind(this),this.connection.onclose=this._onSocketClose.bind(this),this.connection.onmessage=this._onSocketMessage.bind(this)},i.prototype.setSecurityMode=function(t){this.securityMode=t},i.prototype.disconnect=function(t){o.debug("channel.disconnect",arguments),this.isConnected||console.warn("channel is already disconnected"),this.connection.close();var e=this;setTimeout(function(){t&&t(null,e)},0)},i.prototype.publish=function(t,e,n,i){if(o.silly("channel.publish",arguments),!this.isConnected)return console.warn("Channel is not connected.");if(n=n||"broadcast",e=e||null,!r.isString(t))throw new TypeError("event must be a valid string");if(!r.isString(n)&&!r.isArray(n))throw new TypeError("targets must be a valid string or array");this.invoke("ms.channel.emit",{event:t,data:e,to:n},null,!0,i)},i.packMessage=function(t,e){o.debug("channel.packMessage",arguments);var n=JSON.stringify(t),i=new Blob([n]).size,s=new ArrayBuffer(2),r=new DataView(s);return r.setUint16(0,i),new Blob([s,n,e])},i.unpackMessage=function(t){o.debug("channel.unpackMessage",arguments);for(var e="",n=new DataView(t),i=n.getUint16(0),s=0;s<i;s++)e+=String.fromCharCode(n.getUint8(s+2));var r=t.slice(2+i),c=JSON.parse(e);return{payload:r,message:c}},i.prototype.invoke=function(t,e,n,s,c){if(o.debug("channel.invoke",arguments),!r.isString(t))throw new TypeError("method must be a valid string");e=e||{};var a={method:t,params:e};n&&!s&&(a.id=Date.now(),this.resultHandlers[a.id]=n),a=c?i.packMessage(a,c):JSON.stringify(a),this.connection.send(a)},i.prototype._onConnect=function(t){o.silly("channel._onConnect"),this.connected=!0,this.clientId=t.id,t.clients.forEach(function(t){var e=new l(t.id,t.attributes,t.isHost);this.clients.push(e)},this),this.connectCallback&&(o.debug("channel.connect->callback",this.clients.me),this.connectCallback(null,this.clients.me),this.connectCallback=null),o.debug('channel.emit("connect")',this.clients.me),this.emit("connect",this.clients.me)},i.prototype._onDisconnect=function(t){if(o.silly("channel._onDisconnect"),this.connected){var e=this.clients.me;this.clients.clear(),o.debug('channel.emit("disconnect")',e),this.emit("disconnect",e)}this.connected=!1},i.prototype._onClientConnect=function(t){o.silly("channel._onClientConnect");var e=new l(t.id,t.attributes,t.isHost);this.clients.push(e),o.debug('channel.emit("clientConnect")',e),this.emit("clientConnect",e)},i.prototype._onClientDisconnect=function(t){o.silly("channel._onClientDisconnect");var e=this.clients.getById(t.id);e?this.clients.remove(e):(o.warn("client "+t.id+" could not be found, so it was not removed from the client list"),e=new l(t.id,t.attributes,t.isHost)),o.debug('channel.emit("clientDisconnect")',e),this.emit("clientDisconnect",e)},i.prototype._onReady=function(t){o.debug('channel.emit("ready")'),this.emit("ready")},i.prototype._onUserEvent=function(t){var e=this.clients.getById(t.from),n=t.event,i=t.data,s=t.payload;o.debug('channel.emit("'+n+'")',i,e,s),this.emit(n,i,e,s)},i.prototype._onSocketOpen=function(){o.silly("channel._onSocketOpen");var t={method:"ms.webapplication.start",params:{url:this.id}},e={method:"ms.application.start",params:{id:this.id}};"webapplication"===this.type?this.connection.send(JSON.stringify(t)):this.connection.send(JSON.stringify(e))},i.prototype._onSocketClose=function(){o.silly("channel._onSocketClose"),this._onDisconnect()},i.prototype._onSocketError=function(t){o.silly("channel._onSocketError",t),this.emit("error",new Error("WebSocket error"))},i.prototype._onSocketMessage=function(t){o.silly("channel._onSocketMessage",t);try{if("string"==typeof t.data)t=JSON.parse(t.data);else{var e=i.unpackMessage(t.data);t=e.message,t.payload=e.payload}}catch(e){return void o.warn("unable to parse message",t)}if(t.id&&(t.result||t.error)){if(!this.resultHandlers[t.id])return void o.warn("unable to find result handler for result message ",t);this.resultHandlers[t.id](t.error,t.result)}else if(t.event)switch(t.event){case"ms.channel.connect":this._onConnect(t.data);break;case"ms.channel.clientConnect":this._onClientConnect(t.data);break;case"ms.channel.clientDisconnect":this._onClientDisconnect(t.data);break;case"ms.channel.ready":this._onReady(t.data);break;default:this._onUserEvent(t)}else o.warn("unrecognized message type",t)},i.prototype.startHealthCheck=function(){if(this.stopHealthCheck(),this.pingTimeout>0){var t=null;this.on(u,function(e){t=Date.now(),o.debug("ping trip : ",t-e),o.debug("updated last ping time : ",t)});var e=function(){var e=Date.now();t||(t=e),e-t<this.pingTimeout?(o.debug("sending ping"),this.publish(u,e,this.clients.me.id)):(o.debug("ping timed, out closing connection"),this.stopHealthCheck(),this.connection&&(this.connection.close(),this._onDisconnect()))}.bind(this);this.pingInterval=setInterval(e,this.pingTimeout)}},i.prototype.stopHealthCheck=function(){clearInterval(this.pingInterval),this.removeAllListeners(u)},t.exports=i},function(t,e,n){"use strict";function i(t,e,n,i){if(!o.isString(t))throw new TypeError("id must be a valid string");if(e&&!o.isObject(e))throw new TypeError("attributes must be a valid object");this.id=t,this.attributes=e||{},this.isHost=n,this.connectTime=i||Date.now(),Object.freeze(this.attributes),Object.freeze(this)}var s=n(2),o=s.types;t.exports=i},function(t,e,n){"use strict";function i(t){if(!o.isObject(t))throw new TypeError("channel must be of type Channel");this.channel=t,i.super_.call(this)}var s=n(2),o=s.types;s.inherits(i,Array),Object.defineProperty(i.prototype,"me",{get:function(){return this.getById(this.channel.clientId)}}),i.prototype.clear=function(){this.length=0},i.prototype.remove=function(t){var e=this.indexOf(t);return e!==-1?(this.splice(e,1),t):null},i.prototype.getById=function(t){if(!o.isString(t)&&!o.isNumber(t))throw new TypeError("id must be a valid string or number");for(var e=0;e<this.length;e++)if(this[e].id===t)return this[e];return null},t.exports=i},function(t,e,n){"use strict";function i(){i.super_.call(this),this.discorveryFrame=null,this.status=i.STATUS_STOPPED;var t=this,e=[];window.RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;var n=new window.RTCPeerConnection({iceServers:[]}),s=function(){},o=function(t){function n(t,n){e.push(n)}var i=0,s="",o=t.split(".");for(i=0;i<=255;i++)s=o[0]+"."+o[1]+"."+o[2]+"."+i,window.msf.remote("http://"+s+":8001/api/v2/",n)},r=function(){t.onSearchResult(e)};n.createDataChannel(""),n.createOffer(n.setLocalDescription.bind(n),s),n.onicecandidate=function(t){if(t&&t.candidate&&t.candidate.candidate){var e=/([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/.exec(t.candidate.candidate)[1];new o(e);setTimeout(function(){r()},3e3),n.onicecandidate=s}}}var s=n(2),o=(s.props,n(9));s.inherits(i,o),i.STATUS_STOPPED="stopped",i.STATUS_STARTED="started",i.prototype.start=function(){if(this.status===i.STATUS_STOPPED){if(this.discoveryFrame)this.discoveryFrame.postMessage({method:"discovery.search"},"*");else{var t=this;this.once("ready",function(){t.discoveryFrame.postMessage({method:"discovery.search"},"*")})}this.onSearchStart()}else console.warn("a previous search is already in progress")},i.prototype.stop=function(){this.onSearchStop()},i.prototype.onSearchReady=function(){this.emit("ready")},i.prototype.onSearchResult=function(t){this.status!==i.STATUS_STOPPED&&this.emit("found",t),this.status=i.STATUS_STOPPED},i.prototype.onSearchError=function(t){this.emit("error",t),this.status=i.STATUS_STOPPED},i.prototype.onSearchStart=function(){this.status=i.STATUS_STARTED,this.emit("start",this)},i.prototype.onSearchStop=function(){this.status=i.STATUS_STOPPED,this.emit("stop",this)},t.exports=i}]);